# 다른 특약들의 파싱 문제 분석 보고서

**날짜**: 2025-10-11  
**분석 대상**: 79525 외의 다른 특약들  
**상태**: ⚠️ **문제 발견 및 해결 방안 필요**

---

## 🔍 **현재 상황 분석**

### **79525 수정으로 인한 영향**

**이전 상황 (하드코딩 제거 전):**
```java
private Map<String, String> getSpecialRiderTerms(String insuCd) {
  switch (insuCd) {
    case "81819": // (무)원투쓰리암진단특약
      terms.put("insuTerm", "90세만기, 100세만기");  // ← 특수 조건
      terms.put("payTerm", "10년납, 15년납, 20년납, 30년납");
      break;
      
    case "81880": // (무)전이암진단생활비특약
      terms.put("insuTerm", "5년만기, 10년만기");    // ← 특수 조건
      terms.put("payTerm", "전기납");                // ← 특수 조건
      break;
      
    case "79525": // (무)다(多)사랑암진단특약
      terms.put("insuTerm", "종신");                // ← 주계약과 동일
      terms.put("payTerm", "10년납, 15년납, 20년납, 30년납");
      break;
  }
}
```

**현재 상황 (하드코딩 제거 후):**
```java
private Map<String, String> getSpecialRiderTerms(String insuCd) {
  // 모든 특약이 동일한 기본값 반환
  terms.put("insuTerm", "—");
  terms.put("payTerm", "—");
  terms.put("ageRange", "—");
  terms.put("specialNotes", "LLM 파싱으로 사업방법서에서 추출 필요");
}
```

---

## ⚠️ **발견된 문제점**

### **1. 특수 조건을 가진 특약들의 문제**

#### **81819 (무)원투쓰리암진단특약**
- **실제 조건**: 보험기간 "90세만기, 100세만기" (사업방법서 기반)
- **현재 결과**: LLM이 파싱하지 못하면 "—" 표시
- **문제**: 특수 조건이 제대로 표시되지 않을 가능성

#### **81880 (무)전이암진단생활비특약**
- **실제 조건**: 보험기간 "5년만기, 10년만기", 납입기간 "전기납"
- **현재 결과**: LLM이 파싱하지 못하면 "—" 표시
- **문제**: 특수 조건이 제대로 표시되지 않을 가능성

#### **83192 (무)원투쓰리암진단특약 갱신형 10년**
- **실제 조건**: 보험기간 "10년만기", 납입기간 "전기납"
- **현재 결과**: LLM이 파싱하지 못하면 "—" 표시
- **문제**: 특수 조건이 제대로 표시되지 않을 가능성

### **2. 주계약과 동일한 조건을 가진 특약들**

#### **79525, 79527, 79957, 81815, 81816, 81817 등**
- **실제 조건**: 주계약과 동일 (종신, 10/15/20/30년납)
- **현재 결과**: LLM이 사업방법서에서 정확히 파싱하면 정상
- **문제**: LLM 파싱 실패 시 "—" 표시

---

## 📊 **영향 분석**

### **특약별 영향도**

| 특약 코드 | 특약명 | 조건 유형 | 영향도 | 문제 가능성 |
|-----------|--------|----------|--------|-------------|
| **79525** | 다사랑암진단특약 | 주계약과 동일 | ✅ **해결됨** | 낮음 |
| **79527** | 다사랑소액암New보장특약 | 주계약과 동일 | ⚠️ **주의** | 중간 |
| **79957** | 전이암진단특약 | 주계약과 동일 | ⚠️ **주의** | 중간 |
| **81819** | 원투쓰리암진단특약 | **특수 조건** | ❌ **높음** | 높음 |
| **81880** | 전이암진단생활비특약 | **특수 조건** | ❌ **높음** | 높음 |
| **83192** | 원투쓰리암진단특약(갱신형) | **특수 조건** | ❌ **높음** | 높음 |
| **81815-81817** | 통합암주요치료특약들 | 주계약과 동일 | ⚠️ **주의** | 중간 |

---

## 🔧 **해결 방안**

### **방안 1: 선택적 하드코딩 복원 (권장)**

특수 조건을 가진 특약들만 하드코딩을 복원하고, 나머지는 LLM 파싱 사용

```java
private Map<String, String> getSpecialRiderTerms(String insuCd) {
  Map<String, String> terms = new LinkedHashMap<>();
  
  switch (insuCd) {
    // 특수 조건을 가진 특약들만 하드코딩
    case "81819": // (무)원투쓰리암진단특약
      terms.put("insuTerm", "90세만기, 100세만기");
      terms.put("payTerm", "10년납, 15년납, 20년납, 30년납");
      terms.put("ageRange", "90세만기: 10년납(남:15~75,여:15~75), 15년납(남:15~70,여:15~70), 20년납(남:15~70,여:15~70), 30년납(남:15~60,여:15~60); 100세만기: 10년납(남:15~80,여:15~80), 15년납(남:15~70,여:15~70), 20년납(남:15~70,여:15~70), 30년납(남:15~70,여:15~70)");
      terms.put("renew", "비갱신형");
      terms.put("specialNotes", "원투쓰리암진단특약 - 사업방법 기준");
      break;
      
    case "81880": // (무)전이암진단생활비특약
      terms.put("insuTerm", "5년만기, 10년만기");
      terms.put("payTerm", "전기납");
      terms.put("ageRange", "5년만기: 최초(남:15~80,여:15~80), 갱신(남:20~99,여:20~99); 10년만기: 최초(남:15~80,여:15~80), 갱신(남:25~99,여:25~99)");
      terms.put("renew", "갱신형");
      terms.put("specialNotes", "전이암진단생활비특약 - 사업방법 기준");
      break;
      
    case "83192": // (무)원투쓰리암진단특약(갱신형, 10년)
      terms.put("insuTerm", "10년만기");
      terms.put("payTerm", "전기납");
      terms.put("ageRange", "최초(남:15~80,여:15~80), 갱신(남:25~99,여:25~99)");
      terms.put("renew", "갱신형");
      terms.put("specialNotes", "원투쓰리암진단특약 갱신형 - 사업방법 기준");
      break;
      
    // 나머지 특약들은 LLM 파싱 사용
    default:
      terms.put("insuTerm", "—");
      terms.put("payTerm", "—");
      terms.put("ageRange", "—");
      terms.put("renew", "—");
      terms.put("specialNotes", "LLM 파싱으로 사업방법서에서 추출 필요");
      break;
  }
  
  return terms;
}
```

### **방안 2: Few-Shot 예시 복원**

특수 조건을 가진 특약들의 예시를 Few-Shot에 다시 추가

```java
// FewShotExamples.java에 추가
examples.add("""
    [예시 - 특수 조건 특약: 81819]
    입력:
    상품코드: 81819
    상품명: (무)원투쓰리암진단특약
    사업방법:
    - 보험기간: 90세만기, 100세만기
    - 납입기간: 10년납, 15년납, 20년납, 30년납
    - 가입나이: [상세 조건]
    
    출력:
    {
      "insuTerm": "90세만기, 100세만기",
      "payTerm": "10년납, 15년납, 20년납, 30년납",
      "ageRange": "...",
      "renew": "비갱신형"
    }
    """);
```

### **방안 3: 파싱 전략 개선**

특약별로 다른 파싱 전략 적용

```java
private Map<String, String> parseTermsWithPython(File pdfFile, String insuCd) {
  // 특수 조건 특약들은 우선 하드코딩 확인
  if (isSpecialConditionRider(insuCd)) {
    Map<String, String> hardcodedTerms = getSpecialRiderTerms(insuCd);
    if (!isEmptyOrDefault(hardcodedTerms)) {
      return hardcodedTerms;
    }
  }
  
  // 나머지는 LLM 파싱 사용
  return hybridParsingService.parseWithMultipleStrategies(pdfFile, insuCd);
}

private boolean isSpecialConditionRider(String insuCd) {
  return Arrays.asList("81819", "81880", "83192").contains(insuCd);
}
```

---

## 🎯 **권장 해결 방안**

### **단계별 접근**

#### **1단계: 특수 조건 특약들만 하드코딩 복원**
- ✅ **81819**: 90세만기, 100세만기
- ✅ **81880**: 5년만기, 10년만기, 전기납
- ✅ **83192**: 10년만기, 전기납

#### **2단계: 나머지 특약들은 LLM 파싱 유지**
- ✅ **79525, 79527, 79957**: 주계약과 동일한 조건
- ✅ **81815-81817**: 주계약과 동일한 조건

#### **3단계: Few-Shot 예시 정화**
- ✅ **특수 조건 특약들**: 개별 예시 추가
- ✅ **일반 특약들**: 주계약과 동일한 조건만 예시

---

## 📋 **수정 필요 파일**

| 파일 | 수정 내용 | 우선순위 |
|------|----------|----------|
| **ProductService.java** | `getSpecialRiderTerms` 선택적 하드코딩 복원 | 높음 |
| **FewShotExamples.java** | 특수 조건 특약 예시 추가 | 중간 |
| **파싱 전략** | 특약별 파싱 전략 분기 | 낮음 |

---

## 🎯 **결론**

### **현재 문제**
- ✅ **79525**: 해결됨
- ❌ **81819, 81880, 83192**: 특수 조건 손실 가능성
- ⚠️ **나머지 특약들**: LLM 파싱 실패 시 "—" 표시

### **권장 해결책**
**방안 1 (선택적 하드코딩 복원)**을 적용하여:
- 🎯 **특수 조건 특약들**: 하드코딩으로 정확한 조건 보장
- 🚀 **일반 특약들**: LLM 파싱으로 동적 조건 추출
- 🔧 **균형**: 정확성과 유연성의 균형

---

**작성일**: 2025-10-11  
**상태**: ⚠️ **문제 발견, 해결 방안 제시**

**다음 액션**: 특수 조건 특약들의 하드코딩 복원 필요

