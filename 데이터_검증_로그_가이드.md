# 🔍 데이터 검증 로그 시스템 가이드

## 📋 개요
API 호출부터 성공 응답 반환, 프론트엔드 이벤트 발생까지의 전체 데이터 플로우를 검증할 수 있는 로그 시스템을 구축했습니다.

## 🎯 로그 시스템 구성

### **1. 프론트엔드 로그 (브라우저 콘솔)**

#### **수정 제출 시 로그**
```javascript
=== 프론트엔드 API 호출 시작 ===
📤 요청 데이터: {insuCd, originalResult, correctedResult, correctionReason, pdfTextLength}
📤 수정된 필드 개수: 2
📤 수정된 필드 목록: {insuTerm: {original, corrected}, payTerm: {original, corrected}, ...}

=== 프론트엔드 API 응답 수신 ===
📥 응답 데이터: {success: true, message: "수정사항이 학습되었습니다", statistics: {...}}
📥 응답 성공 여부: true
📥 응답 메시지: "수정사항이 학습되었습니다"

=== 프론트엔드 이벤트 발생 시작 ===
🎯 dataUpdated 이벤트 발생
🎯 correctionLogged 이벤트 발생: {insuCd, changedFields}
⏰ 5초 후 지연 새로고침 예약
⏰ 10초 후 최종 새로고침 예약
✅ onSubmitSuccess 콜백 실행 예약 (1초)
```

#### **이벤트 수신 시 로그**
```javascript
=== 프론트엔드 이벤트 수신 ===
🎯 이벤트 타입: dataUpdated
🎯 이벤트 상세: {insuCd, changedFields}
🎯 모달 상태: false
🔄 데이터 수정 감지, 통계 새로고침 시작

=== 통계 로드 시작 ===
🔄 API 호출 시작: fetchStatistics()
✅ API 호출 성공: {totalCorrections, totalPatterns, fewShotExamples, currentAccuracy, improvement}
✅ 통계 상태 업데이트 완료
🏁 통계 로드 완료
```

#### **오류 발생 시 로그**
```javascript
=== 프론트엔드 API 호출 오류 ===
❌ 오류 발생: TypeError: Failed to fetch
❌ 오류 타입: object
❌ 오류 메시지: Failed to fetch
❌ 오류 스택: TypeError: Failed to fetch at ...
🏁 API 호출 완료 (성공/실패 관계없이)
```

### **2. 백엔드 로그 (서버 콘솔)**

#### **API 요청 수신 시 로그**
```java
=== 백엔드 API 요청 수신 ===
📥 요청 데이터: insuCd=21704, productName=삼성생명 종신보험
📥 원본 데이터: insuTerm=1년, payTerm=10년납, ageRange=15~80세, renew=갱신
📥 수정 데이터: insuTerm=종신, payTerm=10년납, ageRange=15~80세, renew=비갱신
📥 수정 이유: PDF에서 누락된 보험기간 수정
📥 PDF 텍스트 길이: 1234
```

#### **데이터베이스 저장 시 로그**
```java
=== 데이터베이스 저장 시작 ===
💾 상품코드: 21704
💾 원본 데이터: {insuTerm=1년, payTerm=10년납, ageRange=15~80세, renew=갱신}
💾 수정 데이터: {insuTerm=종신, payTerm=10년납, ageRange=15~80세, renew=비갱신}
💾 수정 이유: PDF에서 누락된 보험기간 수정
💾 PDF 텍스트 길이: 1234

🔄 CorrectionLog 객체 생성 시작
✅ CorrectionLog 객체 생성 완료: LOG_ID=12345
🔄 CORRECTION_LOG 테이블에 INSERT 시작
✅ CORRECTION_LOG 저장 완료: LOG_ID=12345

🔄 패턴 학습 시작
✅ 패턴 학습 완료

🔄 통계 업데이트 시작
✅ 통계 업데이트 완료

🔄 Few-Shot 예시 생성 확인 시작
✅ Few-Shot 예시 생성 확인 완료

🔄 미학습 로그 수 확인
📊 미학습 로그 수: 3
⏭️ 배치 학습 건너뜀 (10건 미만)

=== 데이터베이스 저장 완료 ===
✅ 학습 완료: 21704
```

#### **API 응답 전송 시 로그**
```java
🔄 학습 서비스 호출 시작
✅ 학습 서비스 호출 완료

📊 통계 조회 시작
📊 통계 조회 완료: corrections=8, patterns=15, fewShot=2, accuracy=91.8

=== 백엔드 API 응답 전송 ===
📤 응답 데이터: success=true, message=수정사항이 학습되었습니다
📤 통계 데이터: LearningStatistics{totalCorrections=8, totalPatterns=15, ...}
```

#### **통계 조회 시 로그**
```java
=== 통계 조회 API 요청 ===
🔄 통계 데이터 조회 시작
✅ 통계 데이터 조회 완료
📊 조회된 통계: corrections=8, patterns=15, fewShot=2, accuracy=91.8, improvement=16.8
📤 통계 응답 전송: {totalCorrections=8, totalPatterns=15, fewShotExamples=2, currentAccuracy=91.8, improvement=16.8}
```

## 🔍 데이터 검증 포인트

### **1. API 호출 검증**
- ✅ **요청 데이터**: 원본/수정 데이터, 수정 이유, PDF 텍스트
- ✅ **응답 데이터**: 성공 여부, 메시지, 통계 데이터
- ✅ **오류 처리**: 네트워크 오류, 서버 오류, 데이터 오류

### **2. 데이터베이스 저장 검증**
- ✅ **CorrectionLog 저장**: LOG_ID, 상품코드, 원본/수정 데이터
- ✅ **패턴 학습**: LEARNED_PATTERN 테이블 저장
- ✅ **통계 업데이트**: LEARNING_STATISTICS 테이블 업데이트
- ✅ **Few-Shot 생성**: FEW_SHOT_EXAMPLE 테이블 저장

### **3. 프론트엔드 반영 검증**
- ✅ **이벤트 발생**: dataUpdated, correctionLogged, fewShotGenerated
- ✅ **통계 새로고침**: 즉시, 5초 후, 10초 후
- ✅ **화면 업데이트**: 통계 데이터 반영 확인

## 🚀 로그 확인 방법

### **1. 브라우저 개발자 도구**
1. F12 키로 개발자 도구 열기
2. Console 탭 선택
3. 수정 제출 후 로그 확인

### **2. 백엔드 서버 콘솔**
1. 백엔드 서버 실행 창 확인
2. API 호출 시 로그 출력 확인
3. 데이터베이스 저장 로그 확인

### **3. 로그 필터링**
- **프론트엔드**: `=== 프론트엔드` 검색
- **백엔드**: `=== 백엔드` 검색
- **데이터베이스**: `=== 데이터베이스` 검색
- **오류**: `❌` 검색

## 📊 예상 로그 플로우

### **정상 케이스**
```
1. 프론트엔드: API 호출 시작
2. 백엔드: API 요청 수신
3. 백엔드: 데이터베이스 저장
4. 백엔드: API 응답 전송
5. 프론트엔드: API 응답 수신
6. 프론트엔드: 이벤트 발생
7. 프론트엔드: 통계 새로고침
8. 백엔드: 통계 조회 API 요청
9. 백엔드: 통계 응답 전송
10. 프론트엔드: 화면 업데이트
```

### **오류 케이스**
```
1. 프론트엔드: API 호출 시작
2. 프론트엔드: 네트워크 오류 발생
3. 프론트엔드: 오류 로그 출력
4. 프론트엔드: 오류 메시지 표시
```

## 🎯 문제 진단 가이드

### **1. API 호출 실패**
- **증상**: `❌ 오류 발생: Failed to fetch`
- **원인**: 백엔드 서버 미실행
- **해결**: 백엔드 서버 실행

### **2. 데이터베이스 저장 실패**
- **증상**: `❌ 오류 발생: SQLException`
- **원인**: 데이터베이스 연결 오류
- **해결**: 데이터베이스 연결 확인

### **3. 이벤트 발생 안함**
- **증상**: `🎯 이벤트 발생` 로그 없음
- **원인**: API 응답 실패
- **해결**: 백엔드 서버 상태 확인

### **4. 화면 업데이트 안됨**
- **증상**: `✅ 통계 상태 업데이트 완료` 로그 있지만 화면 변화 없음
- **원인**: React 상태 업데이트 문제
- **해결**: 컴포넌트 리렌더링 확인

## 📝 로그 분석 체크리스트

- [ ] 프론트엔드 API 호출 로그 확인
- [ ] 백엔드 API 요청 수신 로그 확인
- [ ] 데이터베이스 저장 로그 확인
- [ ] 백엔드 API 응답 전송 로그 확인
- [ ] 프론트엔드 API 응답 수신 로그 확인
- [ ] 프론트엔드 이벤트 발생 로그 확인
- [ ] 통계 새로고침 로그 확인
- [ ] 화면 업데이트 로그 확인

이 로그 시스템을 통해 전체 데이터 플로우를 단계별로 추적하고 문제점을 정확히 진단할 수 있습니다.


